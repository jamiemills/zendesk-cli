@startuml C4-Code
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

title Code Diagram - Core Class Relationships

package "zendesk_cli.models" {
    class Ticket {
        +id: int
        +subject: str
        +description: str
        +status: TicketStatus
        +created_at: datetime
        +updated_at: datetime
        +assignee_id: Optional[int]
        +group_id: Optional[int]
        +url: str
        --
        +short_description: str
        +days_since_created: int
        +days_since_updated: int
    }

    class User {
        +id: int
        +name: str
        +email: str
        +group_ids: List[int]
        +active: bool
    }

    class Group {
        +id: int
        +name: str
        +description: Optional[str]
    }

    class ZendeskConfig {
        +domain: str
        +email: str
        +api_token: Optional[str]
        --
        +from_file(): ZendeskConfig
        +save_to_file(): None
        +get_default_config_path(): Path
    }
}

package "zendesk_cli.services" {
    class ZendeskClient {
        +config: ZendeskConfig
        +session: requests.Session
        --
        +get_current_user(): User
        +get_groups(): List[Group]
        +search_tickets(): List[Ticket]
        +_make_request(): requests.Response
        +_handle_rate_limit(): None
    }

    class TicketService {
        +client: ZendeskClient
        --
        +get_user_tickets(): List[Ticket]
        +get_group_tickets(): List[Group]
        +get_tickets_with_teams(): List[Tuple[Ticket, str]]
        +sort_tickets_with_teams(): List[Tuple[Ticket, str]]
    }

    class AuthService {
        +client: ZendeskClient
        --
        +get_current_user(): User
        +is_authenticated(): bool
        +validate_credentials(): bool
    }
}

package "zendesk_cli.cli" {
    class TicketsCommand {
        --
        +tickets(): None
        +_validate_sort_option(): str
        +_handle_csv_export(): None
    }

    class ConfigureCommand {
        --
        +configure(): None
        +_prompt_for_config(): ZendeskConfig
        +_test_connection(): bool
    }

    class TableFormatter {
        --
        +format_tickets_table(): Table
        +format_tickets_with_teams_table(): Table
        +_create_base_table(): Table
    }

    class CSVExporter {
        --
        +export_tickets_to_csv(): None
        +_write_csv_headers(): None
        +_write_ticket_row(): None
    }
}

package "zendesk_cli.utils" {
    class DateUtils {
        --
        +days_between(): int
        +format_date(): str
        +parse_iso_date(): datetime
    }

    class LoggingConfig {
        --
        +setup_logging(): None
        +get_logger(): logging.Logger
    }
}

' Relationships
TicketService --> ZendeskClient : uses
TicketService --> Ticket : creates
AuthService --> ZendeskClient : uses
AuthService --> User : creates
ZendeskClient --> ZendeskConfig : uses
ZendeskClient --> Ticket : creates
ZendeskClient --> User : creates
ZendeskClient --> Group : creates

TicketsCommand --> TicketService : delegates to
TicketsCommand --> AuthService : uses
TicketsCommand --> TableFormatter : uses
TicketsCommand --> CSVExporter : uses
ConfigureCommand --> AuthService : uses
ConfigureCommand --> ZendeskConfig : creates

TableFormatter --> DateUtils : uses
CSVExporter --> DateUtils : uses
TableFormatter --> Ticket : formats
CSVExporter --> Ticket : exports

@enduml